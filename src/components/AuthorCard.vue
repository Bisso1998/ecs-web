<template>
    <div class="follow-wrap">
        <div class="follow">
            <router-link :to="authorData.pageUrl || authorData.profilePageUrl">
                <div class="follow-img" v-bind:style="{ backgroundImage: 'url(' + authorData.profileImageUrl + (authorData.profileImageUrl.endsWith('/author/image') ? '?' : '&')  + 'width=100)' }"></div>
                <div v-if="authorData.name || authorData.name === ''" class="follow-name">{{ authorData.name }}</div>
                <div v-else class="follow-name">{{ authorData.author.name }}</div>
            </router-link>
            <div class="follow-count">__("author_followers"): 
                <span v-if="authorData.followCount !== undefined">{{ authorData.followCount}}</span>
                <span v-else>{{ authorData.author.followCount }}</span>
            </div>
            
            <span class="button-container">
                <span v-if="authorData.authorId === undefined && authorData.author.authorId !== getUserDetails.authorId">
                    <button class="btn btn-light follow-link" 
                        v-if="authorData.author.following === false"
                        @click="verifyAndFollowOrUnfollowAuthor({ authorId: authorData.author.authorId, following: false })">
                        <i class="material-icons">person_add</i>
                        __("author_follow")
                    </button>
                    <button v-else @click="verifyAndFollowOrUnfollowAuthor({ authorId: authorData.author.authorId, following: true })" class="btn btn-light follow-link">
                        <i class="material-icons">check</i>
                        __("author_following")
                    </button>
                </span>
                <span v-if="authorData.authorId !== undefined && authorData.authorId !== getUserDetails.authorId">
                    <button class="btn btn-light follow-link"
                    v-if="authorData.following === false"
                    @click="verifyAndFollowOrUnfollowAuthor({ authorId: authorData.authorId, following: false })">
                        <i class="material-icons">person_add</i> __("author_follow")
                    </button>
                    <button v-else @click="verifyAndFollowOrUnfollowAuthor({ authorId: authorData.authorId, following: true })" class="btn btn-light follow-link">
                        <i class="material-icons">check</i> __("author_following")
                    </button>    
                </span>
            </span>
            
        </div>
    </div>
</template>

<script>

import { mapGetters, mapActions } from 'vuex'
import mixins from '@/mixins';

export default {
    name: 'Author-Card',
    props: {
        authorData: {
            type: Object,
            required: true
        },
        followOrUnfollowAuthor: {
            type: Function,
            required: true
        },
        inFollowersTab: {
            type: Boolean
        },
        inFollowingTab: {
            type: Boolean
        }
    },
    mixins: [
        mixins
    ],
    data() {
        return {
            
        }
    },
    computed: {
        ...mapGetters([
            'getUserDetails'
        ])
    },
    methods: {
        ...mapActions([
            'setAfterLoginAction'
        ]),
        verifyAndFollowOrUnfollowAuthor(data) {
            if (this.getUserDetails.isGuest) {
                if (this.inFollowingTab) {
                    this.setAfterLoginAction({ action: `${this.$route.meta.store}/followOrUnfollowFollowing`, data });    
                } else if (this.inFollowersTab) {
                    this.setAfterLoginAction({ action: `${this.$route.meta.store}/followOrUnfollowFollowers`, data });    
                } else {
                    this.setAfterLoginAction({ action: `${this.$route.meta.store}/followOrUnfollowAuthor`, data });    
                }
                
                this.openLoginModal(this.$route.meta.store);
            } else {
                this.followOrUnfollowAuthor(data);
            }
        }
    },
    components: {
        
    },
    created() {
    }
}
</script>

<style  lang="scss" scoped>
.follow-wrap {
    display: inline-block;
    overflow: hidden;
}
.follow {
    border: 1px solid #e9e9e9;
    width: 150px;
    display: inline-block;
    margin: 10px 5px;
    position: relative;
    text-align: center;
    a {
        color: #d0021b;
    }
    .follow-img {
        display: block;
        width: 100px;
        height: 100px;
        margin: 10px auto;
        border-radius: 50%;
        background: #eee;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }
    .follow-name {
        font-size: 12px;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 100%;
        min-height: 23px;
        overflow: hidden;
        padding: 0 5px 5px;
    }
    .follow-link {
        background: #d0021b;
        color: #fff;
        font-size: 12px;
        margin: 10px 0;
        i {
            font-size: 16px;
            vertical-align: middle;
        }
    }
    span.button-container {
        height: 50px;
        display: block;
    }
    .follow-count {
        font-size: 11px;
        margin: 0;
        span {
            font-weight: bold;
        }
    }
}
</style>
